{"version":3,"file":"circlepack.umd.js","sources":["../../src/CirclePackManager.js","../../src/CirclePackPoint.js"],"sourcesContent":["const THREE = require('three');\n\nexport default class CirclePackManager {\n  constructor(opts = {}) {\n    this.tightness = 0.5;\n    this.active = true;\n    this.points = [];\n    this.center = opts.center;\n    this.volume = 0;\n    this.updateCallback = opts.onUpdate || null;\n\n    // for optional interaction. positioned offscreen initially\n    this.mouse = new THREE.Vector2(window.innerHeight * 2, window.innerHeight * 2);\n    this.mouseRadius = 100;\n    this.mouseInteractive = true;\n\n    this._tmpPointA = new THREE.Vector2();\n    this._tmpPointB = new THREE.Vector2();\n    this._tmpVec = new THREE.Vector2();\n  }\n\n  calculateVolume() {\n    this.volume = 0;\n\n    for (let i = 0, total = this.points.length; i < total; i += 1) {\n      this.volume += this.points[i].radius;\n    }\n  }\n\n  update() {\n    if (!this.active) { return; }\n\n    let dist;\n    let radii;\n    let inverseForce;\n    const pointTotal = this.points.length;\n\n    for (let i = 0; i < pointTotal; i += 1) {\n      for (let j = 0; j < pointTotal; j += 1) {\n        if (j !== i) {\n          dist = this.points[i].position.distanceToSquared(this.points[j].position);\n          radii = (this.points[i].radius + this.points[j].radius) / 3;\n\n          if (dist < radii * radii) {\n            this._tmpVec.subVectors(this.points[i].position, this.points[j].position).normalize();\n\n            inverseForce = (radii - Math.sqrt(dist));\n            this._tmpVec.multiplyScalar(inverseForce / 3);\n\n            this.points[i].velocity.add(this._tmpVec);\n            this.points[j].velocity.sub(this._tmpVec);\n          }\n        }\n      }\n\n      this.points[i].update();\n    }\n\n    if (this.updateCallback) {\n      this.updateCallback.call();\n    }\n  }\n}\n","const THREE = require('three');\n\nexport default class Point {\n  constructor(opts = {}) {\n    this.position = new THREE.Vector2(opts.x, opts.y);\n    this.velocity = new THREE.Vector2();\n    this.radius = opts.radius;\n    this.points = opts.pointsArray;\n    this.manager = opts.manager; // reference to CirclePackManager instance\n\n    this.index = opts.index;\n    this._tmpVec = new THREE.Vector2(); // reused for various calculations\n\n    this.points[this.index] = this.position.x;\n    this.points[this.index + 1] = this.position.y;\n  }\n\n  update() {\n    const _dist = this.position.distanceTo(this.manager.center);\n\n    this._tmpVec.subVectors(this.manager.center, this.position).multiplyScalar(_dist / 100000000);\n\n    if (_dist > (this.manager.volume / 200) * Math.max(3.5, 80 - this.manager.tightness * 100)) {\n      this._tmpVec.multiplyScalar(1000);\n    }\n\n    this.velocity.add(this._tmpVec);\n\n    if (this.manager.mouseInteractive) {\n      const dist = this.manager.mouse.distanceTo(this.position);\n\n      if (dist < this.manager.mouseRadius) {\n        this._tmpVec.subVectors(this.position, this.manager.mouse).normalize();\n        this.velocity.add(this._tmpVec);\n      }\n    }\n\n    this.velocity.multiplyScalar(0.9);\n    this.position.add(this.velocity);\n\n    this.points[this.index] = this.position.x;\n    this.points[this.index + 1] = this.position.y;\n  }\n}\n"],"names":["THREE","require","CirclePackManager","opts","tightness","active","points","center","volume","updateCallback","onUpdate","mouse","Vector2","window","innerHeight","mouseRadius","mouseInteractive","_tmpPointA","_tmpPointB","_tmpVec","calculateVolume","i","total","length","radius","update","dist","radii","inverseForce","pointTotal","j","position","distanceToSquared","subVectors","normalize","Math","sqrt","multiplyScalar","velocity","add","sub","call","Point","x","y","pointsArray","manager","index","_dist","distanceTo","max"],"mappings":"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"}